<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Joshua‚Äôs Bible Library</title>
  <meta name="description" content="Bible notes, papers, and articles." />

  <style>
    :root{
      /* ===== Ultra-clean editorial system ===== */
      --bg:#fbfbf8;
      --paper:#ffffff;
      --ink:#101418;
      --muted:#586171;
      --rule: rgba(16,20,24,.12);
      --soft: rgba(16,20,24,.06);

      --accent:#1f4bd8;     /* scholarly ‚Äúlink‚Äù blue */
      --accent-2:#0b7a5a;   /* subtle green for highlights */
      --danger:#c53b3b;

      --radius:14px;
      --maxw:1140px;

      --shadow: 0 10px 28px rgba(16,20,24,.08);
      --shadow-soft: 0 6px 18px rgba(16,20,24,.06);

      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --measure: 66ch;
    }

    /* Optional dark theme (kept because your code has a toggle) */
    [data-theme="dark"]{
      --bg:#0f1216;
      --paper:#12161c;
      --ink:#e9edf3;
      --muted:#a6afbf;
      --rule: rgba(233,237,243,.14);
      --soft: rgba(233,237,243,.08);

      --accent:#86a3ff;
      --accent-2:#7bd8b5;
      --danger:#ff6b6b;

      --shadow: 0 18px 40px rgba(0,0,0,.40);
      --shadow-soft: 0 10px 24px rgba(0,0,0,.28);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background: var(--bg);
      color: var(--ink);
      line-height:1.65;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }
    a{color:inherit}
    img, video { max-width: 100%; height: auto; }
    iframe { max-width: 100%; }
    html, body { overflow-x: hidden; }

    /* ===== Layout containers ===== */
    .wrap{max-width:var(--maxw); margin:0 auto; padding:26px 22px}
    main{padding: 18px 0 56px}

    /* ===== Header (institutional / journal-like) ===== */
    header{
      position:sticky; top:0; z-index:50;
      background: color-mix(in srgb, var(--bg) 92%, transparent);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--rule);
    }
    .topbar{
      max-width:var(--maxw);
      margin:0 auto;
      padding: 14px 22px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
      text-decoration:none;
    }
    .logo{
      width:68px; height:68px;
      border-radius:50%;
      object-fit:cover;
      border: 1px solid var(--rule);
      box-shadow: var(--shadow-soft);
      background: var(--paper);
    }
    .brand h1{
      margin:0;
      font-size:15px;
      letter-spacing:.2px;
      font-weight:700;
    }
    .brand p{
      margin:2px 0 0;
      font-size:12px;
      color: var(--muted);
      letter-spacing:.18px;
    }

    /* ===== Nav: clean tabs ===== */
    nav{
      display:flex;
      align-items:center;
      gap:14px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      appearance:none;
      border:0;
      background:transparent;
      color: var(--muted);
      padding: 8px 4px;
      font-size:13px;
      letter-spacing:.18px;
      cursor:pointer;
      border-bottom: 2px solid transparent;
      transition: color .12s ease, border-color .12s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill .dot{display:none;} /* intentionally removed for clean look */
    .pill:hover{ color: var(--ink); }
    .pill.active{
      color: var(--ink);
      border-bottom-color: var(--accent);
    }
    #themeToggle{
      color: var(--ink);
      border: 1px solid var(--rule);
      background: var(--paper);
      padding: 8px 10px;
      border-radius: 999px;
      box-shadow: var(--shadow-soft);
    }
    #themeToggle:hover{ border-color: color-mix(in srgb, var(--accent) 45%, var(--rule)); }

    /* ===== Hero: editorial intro ===== */
    .hero{
  display:grid;
  grid-template-columns: 1fr 1fr; /* double column */
  gap:22px;
  align-items:start;
  margin-top: 10px;
}

    .card{
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: var(--radius);
      box-shadow: var(--shadow-soft);
      padding: 18px;
    }

    .hero h2{
      margin:0 0 10px;
      font-family: var(--serif);
      font-weight: 800;
      letter-spacing:.2px;
      line-height:1.18;
      font-size: 30px;
    }
    .hero p{
      margin:0 0 14px;
      color: var(--muted);
      max-width: var(--measure);
      font-size: 14px;
    }

    /* Search + controls: clean form style */
    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-top: 14px;
    }
    .search{
      flex: 1 1 320px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 12px 12px;
      border: 1px solid var(--rule);
      background: color-mix(in srgb, var(--paper) 92%, var(--bg));
      border-radius: 12px;
    }
    .search input{
      width:100%;
      border:0;
      outline:0;
      background:transparent;
      color: var(--ink);
      font-size: 14px;
    }
    .select{
      border: 1px solid var(--rule);
      background: color-mix(in srgb, var(--paper) 92%, var(--bg));
      border-radius: 12px;
      padding: 12px 12px;
      color: var(--ink);
      font-size: 14px;
      outline:none;
    }

    /* KPIs: make them look like subtle ‚Äúcounts‚Äù */
    .kpis{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid var(--soft);
    }
    .kpi{
      flex: 1 1 140px;
      padding: 10px 0;
      border: 0;
      background: transparent;
    }
    .kpi b{
      display:block;
      font-size: 18px;
      font-weight: 800;
      font-family: var(--serif);
      letter-spacing:.2px;
      color: var(--ink);
    }
    .kpi span{
      font-size: 12px;
      color: var(--muted);
      letter-spacing:.2px;
      text-transform: uppercase;
    }

    /* Podcast card: keep your content but make it ‚Äúfeature‚Äù style */
    .podcast-title{
      font-family: var(--serif);
      font-size: 18px;
      font-weight: 800;
      margin:0 0 10px;
    }
    .podcast-img{
      width:100%;
      border-radius: 12px;
      border:1px solid var(--rule);
      box-shadow: var(--shadow-soft);
      transition: transform .15s ease;
    }
    .podcast-img:hover{ transform: translateY(-2px); }

    /* ===== Main split: library + sidebar ===== */
    .split{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:22px;
      margin-top: 22px;
      align-items:start;
    }

    /* Library header */
    .section-head{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 6px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--soft);
    }
    .section-head h2{
      margin:0;
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 20px;
    }
    .section-head .count{
      color: var(--muted);
      font-size: 13px;
    }

    /* ===== Library entries: citation-like list cards ===== */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:14px;
      margin-top: 14px;
    }
    @media (min-width: 1080px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 820px){
  .split{ grid-template-columns: 1fr; }
  .grid{ grid-template-columns: 1fr; }
}

@media (max-width: 620px){
  .hero{ grid-template-columns: 1fr; } /* collapse only on phones */
}

    .item{
      background: var(--paper);
      border: 1px solid var(--rule);
      border-radius: 12px;
      padding: 14px 14px 12px;
      cursor:pointer;
      transition: border-color .12s ease, transform .12s ease, box-shadow .12s ease;
      box-shadow: none;
      min-height: 150px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      position:relative;
      overflow:hidden;
    }

    /* left ‚Äúaccent rule‚Äù */
    .item::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width: 3px;
      background: color-mix(in srgb, var(--accent) 55%, transparent);
      opacity:.35;
    }

    .item:hover{
      transform: translateY(-2px);
      border-color: color-mix(in srgb, var(--accent) 40%, var(--rule));
      box-shadow: var(--shadow-soft);
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-size: 11px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .badge strong{
      color: var(--ink);
      font-weight: 800;
      letter-spacing:.14em;
    }

    .title{
      margin:0 0 8px;
      font-family: var(--serif);
      font-weight: 900;
      font-size: 17px;
      line-height:1.25;
      letter-spacing:.2px;
      color: var(--ink);
    }

    .excerpt{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.55;
      display:-webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow:hidden;
      max-width: var(--measure);
    }

    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding-top: 10px;
      border-top: 1px solid var(--soft);
      color: var(--muted);
      font-size: 12px;
    }
    .tags{display:flex; gap:6px; flex-wrap:wrap}
    .tag{
      font-family: var(--mono);
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--soft);
      background: color-mix(in srgb, var(--paper) 90%, var(--bg));
      color: color-mix(in srgb, var(--muted) 75%, var(--ink));
    }

    /* ===== Sidebar blocks ===== */
    .aside h2{
      font-family: var(--serif);
      font-weight: 900;
      letter-spacing:.2px;
      margin:0 0 10px;
      font-size: 18px;
    }
    .aside p, .aside ol{
      color: var(--muted);
      font-size: 13px;
      margin:0;
    }

    .quicklinks{
      border:1px solid var(--soft);
      border-radius: 12px;
      padding: 12px;
      background: color-mix(in srgb, var(--paper) 92%, var(--bg));
      margin-top: 12px;
    }
    .quicklinks b{
      display:block;
      font-size: 12px;
      letter-spacing:.16em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }
    .smalllink{
      color: var(--muted);
      text-decoration:none;
    }
    .smalllink:hover{ color: var(--ink); text-decoration: underline; text-underline-offset: 3px; }

    /* ===== Footer ===== */
    .footer{
      margin-top: 26px;
      padding-top: 16px;
      border-top: 1px solid var(--rule);
      color: var(--muted);
      font-size: 12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    /* ===== Reader modal ===== */
    .overlay{
      position:fixed; inset:0; z-index:100;
      background: rgba(0,0,0,.50);
      display:none; align-items:center; justify-content:center;
      padding: 18px;
    }
    .overlay.show{display:flex;}
    .modal{
      width:min(980px, 100%);
      max-height: 88vh;
      overflow:auto;
      border-radius: 14px;
      border:1px solid var(--rule);
      background: var(--paper);
      box-shadow: var(--shadow);
    }
    .modal header{
      position:sticky; top:0;
      background: color-mix(in srgb, var(--paper) 94%, transparent);
      border-bottom: 1px solid var(--rule);
      padding: 12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      backdrop-filter: blur(10px);
    }
    .modal header h3{
      margin:0;
      font-size: 11px;
      letter-spacing:.18em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .modal .content{ padding: 16px; }
    .modal .content h1{
      margin:0 0 8px;
      font-family: var(--serif);
      font-weight: 900;
      font-size: 24px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .modal .content .sub{
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 12px;
    }
    .modal .content .body{
      white-space: pre-wrap;
      font-size: 15px;
    }

    .btn{
      border:1px solid var(--rule);
      background: color-mix(in srgb, var(--paper) 90%, var(--bg));
      color: var(--ink);
      padding: 9px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 13px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      transition: transform .12s ease, border-color .12s ease;
    }
    .btn:hover{
      transform: translateY(-1px);
      border-color: color-mix(in srgb, var(--accent) 40%, var(--rule));
    }
    .btn.danger{
      border-color: color-mix(in srgb, var(--danger) 45%, var(--rule));
    }

    /* Fix weird underline on "Download PDF" */
    .pdf-actions { margin: 10px 0 0; }
    .download-link{
      display: inline;
      width: auto;
      padding: 0;
      text-decoration: underline;
      text-decoration-thickness: 1px;
      text-underline-offset: 3px;
      color: color-mix(in srgb, var(--accent) 85%, var(--ink));
    }
    .download-link:hover{ color: var(--accent); }

    /* ===== Mobile: keep your functionality + nicer stacking ===== */
    @media (max-width: 620px) {
      .wrap{ padding: 18px 14px; }
      .topbar{
        padding: 12px 14px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .brand{ width:100%; min-width: unset; }
      .logo{ width: 62px; height: 62px; }

      nav{
        width: 100%;
        gap: 10px;
      }
      .pill{
        padding: 8px 0;
      }
      #themeToggle{
        margin-left:auto;
      }

      .controls{
        flex-direction: column;
        align-items: stretch;
      }
      .search, .select{
        width: 100%;
      }
      .search input{
        font-size: 16px; /* prevent iOS zoom */
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="topbar">
      <a class="brand" href="#" id="homeLink">
        <img class="logo" src="IMG_6142.jpeg" alt="Joshua Haub" />
        <div>
          <!-- KEEP: photo + title (changed per your request) -->
          <h1>Joshua Haub Bible Material</h1>
          <p>Notes ‚Ä¢ Papers ‚Ä¢ Articles</p>
        </div>
      </a>

      <nav aria-label="Primary">
        <button class="pill active" id="filterAll">All</button>
        <button class="pill" id="filterNotes">Notes</button>
        <button class="pill" id="filterPapers">Papers</button>
        <button class="pill" id="filterArticles">Articles</button>
<button class="pill" id="langToggle" data-lang="en">Espa√±ol</button>
<button class="pill" id="themeToggle" title="Toggle theme">Theme</button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="card">
        <h2>Welcome to my Bible Library</h2>
        <p>
          Feel free to download these files for personal use in your personal Bible study.
        </p>

        <div class="controls">
          <div class="search" role="search" aria-label="Search library">
            üîé
            <input id="searchInput" placeholder="Search titles, content, tags‚Ä¶ (e.g., ‚Äútextual criticism‚Äù)" />
          </div>

          <select class="select" id="sortSelect" aria-label="Sort">
            <option value="newest">Sort: Newest</option>
            <option value="oldest">Sort: Oldest</option>
            <option value="titleaz">Sort: Title A‚ÄìZ</option>
            <option value="titleza">Sort: Title Z‚ÄìA</option>
          </select>

          <select class="select" id="tagSelect" aria-label="Tag filter">
            <option value="">Tag: (All)</option>
          </select>
        </div>

        <div class="kpis" id="kpis"></div>
      </div>

      <!-- KEEP: Podcast content + link + image -->
      <aside class="card">
        <h2 class="podcast-title">The ‚ÄúWhat Does It Say?‚Äù Podcast</h2>

        <a
          href="https://creators.spotify.com/pod/profile/whatdoesitsay/"
          target="_blank"
          rel="noopener noreferrer"
          style="display:block; text-decoration:none;"
        >
          <img
            class="podcast-img"
            src="ab6765630000ba8ae3f49b0a8f0157a58ad2f1a6.jfif"
            alt="The What Does It Say? Podcast"
          />
        </a>

        <p style="color:var(--muted); font-size:13px; margin-top:10px;">
          In my Podcast, I aim to provide you, the listener, with a detailed account of what the Scripture says, so that in your study, you may have more than just your own ideas to consult.
        </p>
      </aside>
    </section>

    <section class="split">
      <div>
        <div class="section-head">
          <h2>Library</h2>
          <div class="count"><span id="resultsCount">0</span> results</div>
        </div>

        <div class="grid" id="grid"></div>
      </div>

      <!-- KEEP: About + Quick Links + How To Contact Me content -->
      <aside class="card aside">
        <h2>About</h2>
        <p>
          My name is Joshua Haub and I am an Evangelist and Preacher. My goal in life is to help other people learn about God and His Word. Please feel free to use my material here (free of charge) however best helps you understand these important matters.
        </p>

        <div class="quicklinks">
          <b>Quick Links</b>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <a class="smalllink" href="#" onclick="setTypeFilter('All'); return false;">‚Ä¢ Home</a>
            <a class="smalllink" href="#" onclick="setTypeFilter('Notes'); return false;">‚Ä¢ Notes</a>
            <a class="smalllink" href="#" onclick="setTypeFilter('Papers'); return false;">‚Ä¢ Papers</a>
            <a class="smalllink" href="#" onclick="setTypeFilter('Articles'); return false;">‚Ä¢ Articles</a>
          </div>
        </div>

        <div style="height:16px"></div>

        <h2>How To Contact Me</h2>
        <ol style="margin:0; padding-left:18px; color:var(--muted); font-size:13px;">
          <li>
            Instagram
            <span style="font-family:var(--mono)">
              <a href="https://www.instagram.com/generousj_?igsh=MXkya3I5eXFmdXBqOA%3D%3D&utm_source=qr" target="_blank" rel="noopener noreferrer">
                https://www.instagram.com/generousj_
              </a>
            </span>
          </li>
          <li>
            Facebook
            <span style="font-family:var(--mono)">
              <a href="https://www.facebook.com/joshua.haub.538481" target="_blank" rel="noopener noreferrer">
                https://www.facebook.com/joshua.haub.538481
              </a>
            </span>
          </li>
          <li>
            X <span style="font-family:var(--mono)">(Formerly Twitter)</span>
            <span style="font-family:var(--mono)">
              <a href="https://x.com/joshhaub" target="_blank" rel="noopener noreferrer">
                https://x.com/joshhaub
              </a>
            </span>
          </li>
        </ol>
      </aside>
    </section>

    <!-- KEEP: footer text -->
    <footer class="footer">
      <div>¬© <span id="year"></span> Joshua‚Äôs Bible Library</div>
      <div>To Him Be the Glory</div>
    </footer>
  </main>

  <!-- Reader Modal (KEEP: same IDs/logic; cleaner skin) -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Reader">
    <div class="modal">
      <header>
        <h3 id="modalType">Reader</h3>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn" id="downloadBtn" href="#" download title="Download PDF" style="display:none;">‚¨áÔ∏è</a>
          <button class="btn" id="copyLinkBtn">Copy Link</button>
          <button class="btn danger" id="closeBtn">Close</button>
        </div>
      </header>
      <div class="content">
        <h1 id="modalTitle"></h1>
        <div class="sub" id="modalSub"></div>
        <div class="tags" id="modalTags" style="margin-bottom:12px;"></div>
        <div class="body" id="modalBody"></div>
      </div>
    </div>
  </div>

  <script>
    /*************************************************************
     * EDIT YOUR CONTENT HERE
     *************************************************************/
    const CONTENT = [
      {
        id: "john-7-53-8-11",
        type: "Papers",
        title: "Is John 7:53‚Äì8:11 Part of the Original Text of John?",
        date: "2026-01-06",
        featured: false,
        tags: ["John", "Textual Criticism", "Pericope Adulterae", "Church Fathers", "Manuscript"],
        excerpt: "A textual-critical analysis of John 7:53‚Äì8:11 and its external evidence from the Manuscript Witnesses and Early Church Fathers.",
        pdfHref: "Is John 7.53-8.11 Part of the Original Text of John (PDF).pdf",
        body: `
<iframe
  src="Is John 7.53-8.11 Part of the Original Text of John (PDF).pdf"
  width="100%"
  height="900"
  style="border:none;"
></iframe>

<p class="pdf-actions">
  <a class="download-link" href="Is John 7.53-8.11 Part of the Original Text of John (PDF).pdf" download>Download PDF</a>
</p>
`
      },

      {
        id: "luke-23-34a-authorship",
        type: "Papers",
        title: "The External Evidence for the Authenticity of Luke 23:34a",
        date: "2026-01-07",
        featured: false,
        tags: ["Luke", "Textual Criticism", "Manuscripts", "Church Fathers"],
        excerpt: "A textual-critical analysis of Luke 23:34a and its external evidence from the Manuscript Witnesses and Early Church Fathers.",
        pdfHref: "The%20External%20Evidence%20for%20the%20Authorship%20of%20Luke%2023.34a.%20An%20Examination%20of%20the%20Evidence%20from%20the%20Manuscript%20and%20Church%20Father%20Witnesses.pdf",
        body: `
<iframe
  src="The%20External%20Evidence%20for%20the%20Authorship%20of%20Luke%2023.34a.%20An%20Examination%20of%20the%20Evidence%20from%20the%20Manuscript%20and%20Church%20Father%20Witnesses.pdf"
  width="100%"
  height="900"
  style="border:none;"
></iframe>

<p class="pdf-actions">
  <a class="download-link" href="The%20External%20Evidence%20for%20the%20Authorship%20of%20Luke%2023.34a.%20An%20Examination%20of%20the%20Evidence%20from%20the%20Manuscript%20and%20Church%20Father%20Witnesses.pdf" download>Download PDF</a>
</p>
`
      },

      {
        id: "1cor-14-34-35-authorship",
        type: "Papers",
        title: "Who Wrote 1 Cor. 14:34‚Äì35 ‚Äî Paul or Someone Else?",
        date: "2026-01-07",
        featured: false,
        tags: ["1 Corinthians", "Textual Criticism", "Manuscript"],
        excerpt: "A textual-critical analysis of 1 Corinthians 14:34-5 and its external evidence from the Manuscript Witnesses.",
        pdfHref: "Who Wrote 1 Cor. 14.34-5. Paul or Someone Else (PDF).pdf",
        body: `
<iframe
  src="Who Wrote 1 Cor. 14.34-5. Paul or Someone Else (PDF).pdf"
  width="100%"
  height="900"
  style="border:none;"
></iframe>

<p class="pdf-actions">
  <a class="download-link" href="Who Wrote 1 Cor. 14.34-5. Paul or Someone Else (PDF).pdf" download>Download PDF</a>
</p>
`
      }
    ];

    /*************************************************************
     * APP LOGIC (No need to edit below unless you want to)
     *************************************************************/
    const els = {
      grid: document.getElementById("grid"),
      featuredList: document.getElementById("featuredList"),
      kpis: document.getElementById("kpis"),
      resultsCount: document.getElementById("resultsCount"),
      searchInput: document.getElementById("searchInput"),
      sortSelect: document.getElementById("sortSelect"),
      tagSelect: document.getElementById("tagSelect"),
      year: document.getElementById("year"),

      filterAll: document.getElementById("filterAll"),
      filterNotes: document.getElementById("filterNotes"),
      filterPapers: document.getElementById("filterPapers"),
      filterArticles: document.getElementById("filterArticles"),
      themeToggle: document.getElementById("themeToggle"),
      langToggle: document.getElementById("langToggle"),

      overlay: document.getElementById("overlay"),
      modalTitle: document.getElementById("modalTitle"),
      modalSub: document.getElementById("modalSub"),
      modalBody: document.getElementById("modalBody"),
      modalTags: document.getElementById("modalTags"),
      modalType: document.getElementById("modalType"),
      closeBtn: document.getElementById("closeBtn"),
      copyLinkBtn: document.getElementById("copyLinkBtn"),
      downloadBtn: document.getElementById("downloadBtn"),

      exportBtn: document.getElementById("exportBtn"),
      importBtn: document.getElementById("importBtn"),
      clearFiltersBtn: document.getElementById("clearFiltersBtn"),
      homeLink: document.getElementById("homeLink"),
    };

    let state = {
      type: "All",
      query: "",
      tag: "",
      sort: "newest",
      theme: "light", // clean professional default
      lang: "en",
    };

    // ‚úÖ Load saved theme safely
    try {
      const saved = localStorage.getItem("theme");
      if (saved === "light" || saved === "dark") state.theme = saved;
    } catch (e) {}

    function applyTheme() {
      document.documentElement.setAttribute(
        "data-theme",
        state.theme === "dark" ? "dark" : "light"
      );
      try { localStorage.setItem("theme", state.theme); } catch (e) {}
    }

    function normalize(s){ return (s || "").toLowerCase(); }

    function formatDate(iso){
      try {
        const [y,m,d] = iso.split("-").map(Number);
        const dt = new Date(y, m-1, d);
        return dt.toLocaleDateString(undefined, {year:"numeric", month:"short", day:"numeric"});
      } catch { return iso; }
    }

    function contentMatches(item) {
      const q = normalize(state.query).trim();
      if (state.type !== "All" && item.type !== state.type) return false;
      if (state.tag && !(item.tags || []).includes(state.tag)) return false;
      if (state.lang === "es" && !(item.tags || []).includes("Espa√±ol")) return false;

      if (!q) return true;

      const hay = normalize([
        item.title,
        item.excerpt,
        item.body,
        (item.tags || []).join(" ")
      ].join(" | "));

      return hay.includes(q);
    }

    function sortItems(items) {
      const s = state.sort;
      const copy = [...items];
      if (s === "newest") copy.sort((a,b)=> (b.date || "").localeCompare(a.date || ""));
      if (s === "oldest") copy.sort((a,b)=> (a.date || "").localeCompare(b.date || ""));
      if (s === "titleaz") copy.sort((a,b)=> (a.title || "").localeCompare(b.title || ""));
      if (s === "titleza") copy.sort((a,b)=> (b.title || "").localeCompare(a.title || ""));
      return copy;
    }

    function setActiveFilterButtons(){
      const map = {
        "All": els.filterAll,
        "Notes": els.filterNotes,
        "Papers": els.filterPapers,
        "Articles": els.filterArticles
      };
      [els.filterAll, els.filterNotes, els.filterPapers, els.filterArticles].forEach(b=>b.classList.remove("active"));
      map[state.type].classList.add("active");
    }

    function buildKPIs(){
      const total = CONTENT.length;
      const notes = CONTENT.filter(x=>x.type==="Notes").length;
      const papers = CONTENT.filter(x=>x.type==="Papers").length;
      const articles = CONTENT.filter(x=>x.type==="Articles").length;
      const featured = CONTENT.filter(x=>x.featured).length;

      const kpis = [
        {label:"Total", value: total},
        {label:"Notes", value: notes},
        {label:"Papers", value: papers},
        {label:"Articles", value: articles},
        {label:"Featured", value: featured},
      ];

      els.kpis.innerHTML = kpis.map(k=>`
        <div class="kpi">
          <b>${k.value}</b>
          <span>${k.label}</span>
        </div>
      `).join("");
    }

    function buildTagSelect(){
      const set = new Set();
      CONTENT.forEach(x => (x.tags || []).forEach(t => set.add(t)));
      const tags = Array.from(set).sort((a,b)=>a.localeCompare(b));
      const current = state.tag;

      els.tagSelect.innerHTML =
        `<option value="">Tag: (All)</option>` +
        tags.map(t=>`<option value="${escapeHtml(t)}"${t===current ? " selected":""}>Tag: ${escapeHtml(t)}</option>`).join("");
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function itemCard(item){
      const tags = (item.tags || []).slice(0,4).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("");
      const extra = (item.tags || []).length > 4 ? `<span class="tag">+${(item.tags||[]).length - 4}</span>` : "";
      return `
        <article class="item" tabindex="0" role="button" aria-label="Open ${escapeHtml(item.title)}" data-id="${escapeHtml(item.id)}">
          <div>
            <div class="badge"><strong>${escapeHtml(item.type)}</strong> ¬∑ ${escapeHtml(formatDate(item.date || ""))}</div>
            <h3 class="title">${escapeHtml(item.title)}</h3>
            <p class="excerpt">${escapeHtml(item.excerpt || "")}</p>
          </div>
          <div class="meta">
            <div class="tags">${tags}${extra}</div>
            <div></div>
          </div>
        </article>
      `;
    }

    function renderFeatured(){
      if (!els.featuredList) return;
      const featured = sortItems(CONTENT.filter(x=>x.featured)).slice(0, 4);

      if (!featured.length){
        els.featuredList.innerHTML = `<div style="color:var(--muted);font-size:13px;">No featured posts yet.</div>`;
        return;
      }

      els.featuredList.innerHTML = featured.map(x=>`
        <div class="item" style="min-height:auto;" data-id="${escapeHtml(x.id)}">
          <div class="badge"><strong>${escapeHtml(x.type)}</strong> ¬∑ ${escapeHtml(formatDate(x.date || ""))}</div>
          <div style="height:6px"></div>
          <div style="font-weight:650;">${escapeHtml(x.title)}</div>
          <div style="color:var(--muted);font-size:12px;margin-top:4px;">${escapeHtml(x.excerpt || "")}</div>
        </div>
      `).join("");
    }

    function renderGrid(){
      setActiveFilterButtons();

      const filtered = CONTENT.filter(contentMatches);
      const sorted = sortItems(filtered);

      els.resultsCount.textContent = sorted.length;
      els.grid.innerHTML = sorted.map(itemCard).join("") || `
        <div class="card" style="grid-column: 1/-1;">
          <b>No results.</b>
          <div style="color:var(--muted); margin-top:6px;">
            Try removing filters or searching a different term.
          </div>
        </div>
      `;

      document.querySelectorAll("[data-id]").forEach(el=>{
        el.addEventListener("click", ()=> openReader(el.getAttribute("data-id")));
        el.addEventListener("keydown", (e)=>{
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openReader(el.getAttribute("data-id"));
          }
        });
      });
    }

    function isMobileView() {
      return window.matchMedia("(max-width: 620px)").matches;
    }

    function openReader(id){
      const item = CONTENT.find(x=>x.id === id);
      if (!item) return;

      els.modalType.textContent = item.type;
      els.modalTitle.textContent = item.title;
      els.modalSub.textContent = `${formatDate(item.date || "")} ‚Ä¢ ${item.featured ? "Featured ‚Ä¢ " : ""}${(item.tags || []).join(" ‚Ä¢ ")}`;

      if (isMobileView() && item.pdfHref) {
        history.replaceState(null, "", "#/");
        window.open(item.pdfHref, "_blank", "noopener,noreferrer");
        return;
      }

      els.modalBody.innerHTML = item.body || "";

      if (item.pdfHref) {
        els.downloadBtn.href = item.pdfHref;
        els.downloadBtn.style.display = "inline-flex";
      } else {
        els.downloadBtn.href = "#";
        els.downloadBtn.style.display = "none";
      }

      els.modalTags.innerHTML = (item.tags || []).map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join("");

      els.overlay.classList.add("show");
      document.body.style.overflow = "hidden";
      history.replaceState(null, "", `#/${encodeURIComponent(item.id)}`);
    }

    function closeReader(){
      els.overlay.classList.remove("show");
      document.body.style.overflow = "";
      history.replaceState(null, "", "#/");
    }

    function hydrateFromHash(){
      const h = location.hash || "#/";
      const m = h.match(/^#\/(.+)$/);
      if (m && m[1] && m[1] !== "") {
        const id = decodeURIComponent(m[1]);
        const exists = CONTENT.some(x=>x.id === id);
        if (exists) openReader(id);
      }
    }

    function setTypeFilter(type){
      state.type = type;
      renderGrid();
      scrollToTop();
    }
    window.setTypeFilter = setTypeFilter;

    function scrollToTop(){
      window.scrollTo({top:0, behavior:"smooth"});
    }
    window.scrollToTop = scrollToTop;

    function clearFilters(){
      state.type = "All";
      state.query = "";
      state.tag = "";
      state.sort = "newest";
      els.searchInput.value = "";
      els.sortSelect.value = "newest";
      buildTagSelect();
      renderGrid();
      scrollToTop();
    }

    function exportJSON(){
      const payload = JSON.stringify(CONTENT, null, 2);
      const blob = new Blob([payload], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bible-library-content.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importJSON(){
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = async () => {
        const file = input.files && input.files[0];
        if (!file) return;
        const text = await file.text();
        try {
          const parsed = JSON.parse(text);
          if (!Array.isArray(parsed)) throw new Error("JSON must be an array.");
          alert("Imported JSON successfully. NOTE: This demo file does not overwrite the hard-coded CONTENT array.\n\nTo use imports permanently, you‚Äôd store parsed data in localStorage or load it from a separate .json file.");
        } catch (e) {
          alert("Import failed: " + e.message);
        }
      };
      input.click();
    }

    els.filterAll.addEventListener("click", ()=> setTypeFilter("All"));
els.filterNotes.addEventListener("click", ()=> setTypeFilter("Notes"));
els.filterPapers.addEventListener("click", ()=> setTypeFilter("Papers"));
els.filterArticles.addEventListener("click", ()=> setTypeFilter("Articles"));

els.themeToggle.addEventListener("click", ()=>{
  state.theme = (state.theme === "light") ? "dark" : "light";
  applyTheme();
});

els.langToggle.addEventListener("click", ()=>{
  if (state.lang === "en") {
    state.lang = "es";
    els.langToggle.textContent = "English";
  } else {
    state.lang = "en";
    els.langToggle.textContent = "Espa√±ol";
  }
  renderGrid();
  scrollToTop();
});

    els.searchInput.addEventListener("input", (e)=>{
      state.query = e.target.value || "";
      renderGrid();
    });

    els.sortSelect.addEventListener("change", (e)=>{
      state.sort = e.target.value;
      renderGrid();
    });

    els.tagSelect.addEventListener("change", (e)=>{
      state.tag = e.target.value || "";
      renderGrid();
    });

    els.closeBtn.addEventListener("click", closeReader);
    els.overlay.addEventListener("click", (e)=>{
      if (e.target === els.overlay) closeReader();
    });
    document.addEventListener("keydown", (e)=>{
      if (e.key === "Escape" && els.overlay.classList.contains("show")) closeReader();
    });

    els.copyLinkBtn.addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(location.href);
        els.copyLinkBtn.textContent = "Copied!";
        setTimeout(()=> els.copyLinkBtn.textContent = "Copy Link", 900);
      } catch {
        alert("Couldn‚Äôt copy automatically. You can manually copy the URL from the address bar.");
      }
    });

    els.exportBtn?.addEventListener("click", (e)=>{ e.preventDefault(); exportJSON(); });
    els.importBtn?.addEventListener("click", (e)=>{ e.preventDefault(); importJSON(); });
    els.clearFiltersBtn?.addEventListener("click", (e)=>{ e.preventDefault(); clearFilters(); });
    els.homeLink?.addEventListener("click", (e)=>{ e.preventDefault(); scrollToTop(); });

    function init() {
      if (!location.hash) history.replaceState(null, "", "#/");
      applyTheme();

      els.year.textContent = new Date().getFullYear();

      buildKPIs();
      buildTagSelect();
      if (els.featuredList) renderFeatured();

      state.type = "All";
      renderGrid();

      hydrateFromHash();
      window.addEventListener("hashchange", hydrateFromHash);
    }

    if (document.readyState === "loading") {
      window.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  </script>
</body>
</html>
